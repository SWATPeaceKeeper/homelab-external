// ==========================================================================
// HEADSCALE ACL (Access Control List)
// ==========================================================================
// Dokumentation: https://headscale.net/stable/ref/acls/
// Format: HuJSON (JSON mit Kommentaren)
//
// Nach Änderungen: docker compose restart headscale
// ==========================================================================

{
  // GRUPPEN
  "groups": {
    "group:admin": [
      "robin@homelab"
    ],
    "group:server": [
      "hetzner-server@homelab"
    ]
  },

  // TAG OWNERS
  "tagOwners": {
    "tag:server": ["group:admin"]
  },

  // HOSTS (Aliase)
  "hosts": {
    "homelab-network": "10.0.0.0/24"
  },

  // ACL REGELN
  "acls": [
    // Admins: voller Zugriff
    {
      "action": "accept",
      "src": ["group:admin"],
      "dst": ["*:*"]
    },

    // Hetzner-Server: Monitoring-Zugriff auf Homelab
    {
      "action": "accept",
      "src": ["group:server"],
      "dst": [
        "homelab-network:22",
        "homelab-network:80",
        "homelab-network:443",
        "homelab-network:3000",
        "homelab-network:8080",
        "homelab-network:8123",
        "homelab-network:9090",
        "homelab-network:9100"
      ]
    },

    // ICMP (Ping) für Diagnose
    {
      "action": "accept",
      "src": ["*"],
      "dst": ["*:*"],
      "proto": "icmp"
    }
  ],

  // SSH REGELN (Tailscale SSH)
  "ssh": [
    {
      "action": "accept",
      "src": ["group:admin"],
      "dst": ["autogroup:member", "autogroup:tagged"],
      "users": ["autogroup:nonroot", "root"]
    }
  ]
}
